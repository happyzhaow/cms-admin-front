webpackJsonp([15,11],{230:function(t,e,a){e=t.exports=a(2)(),e.push([t.id,"",""])},257:function(t,e,a){var r=a(230);"string"==typeof r&&(r=[[t.id,r,""]]);a(3)(r,{});r.locals&&(t.exports=r.locals)},443:function(t,e,a){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=a(4),n=r(o),i=a(27),l=a(217),s=r(l),u=a(8),f=r(u);e.default={props:["data","value"],mixins:[s.default],components:{MarkdownEditor:i.MarkdownEditor},watch:{"form.content":function(){var t=this;this.$nextTick(function(){t.generatorSummary()})}},created:function(){var t=this;this.$get("catalog/list").then(function(e){var a=e.data;t.catalogs=a}),this.$get("tag/list").then(function(e){var a=e.data;t.tags=a})},computed:{banner:function(){var t=[];return this.form.banner&&(t=[{name:"banner",url:this.form.banner}]),t},isDraft:function(){return 1===this.form.status},uploadConfig:function(){return{url:f.default.globalOptions.uploadUrl,name:"file",accept:"image/jpg,image/jpeg,image/png,image/gif",header:this.mix_headers}}},data:function(){return{catalogs:[],tags:[],form:(0,n.default)({content:"",title:"",summary:"",banner:"",catalogId:null,status:1,tagIds:[]},this.data),rules:{title:{required:!0}}}},methods:{uploadError:function(t){this.$message.error("upload error: "+(t.responseText||t))},uploadSuccess:function(t){this.form.banner=t},generatorSummary:function(){this.form.summary=this.$refs.editor.getText().replace(/\n/g," ").substr(0,300)},saveDraft:function(){this.saveHistory(),this.$emit("close")},saveHistory:function(){var t=this;if(this.isDraft)return this.$post("article/save/draft",this.form,{emulateJSON:!1}).then(function(e){var a=e.data;t.form.id!==a.id&&(t.form=(0,n.default)({},t.form,{id:a.id}))})},saveAction:function(){this.generatorSummary(),this.$emit("save",this.form)}}}},466:function(t,e,a){var r,o;a(257),r=a(443);var n=a(492);o=r=r||{},"object"!=typeof r.default&&"function"!=typeof r.default||(o=r=r.default),"function"==typeof o&&(o=o.options),o.render=n.render,o.staticRenderFns=n.staticRenderFns,t.exports=r},492:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"article-editor"},[a("el-form",{ref:"form",attrs:{"label-position":"left","label-width":"100px",rules:t.rules,model:t.form}},[a("div",{staticClass:"flexrow"},[a("el-upload",{staticClass:"flex-1 full-upload",attrs:{action:t.uploadConfig.url,name:t.uploadConfig.name,"thumbnail-mode":!0,type:"drag","on-success":t.uploadSuccess,"default-file-list":t.banner,multiple:!1,headers:t.uploadConfig.header,"on-error":t.uploadError}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-dragger__text"},[t._v("上传文章的banner图")])]),a("div",{staticClass:"flex-1"},[a("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[a("el-input",{model:{value:t.form.title,callback:function(e){t.form.title=e},expression:"form.title"}})],1),a("el-form-item",{attrs:{label:"所属栏目"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.form.catalogId,callback:function(e){t.form.catalogId=e},expression:"form.catalogId"}},t._l(t.catalogs,function(t){return a("el-option",{attrs:{label:t.name,value:t.id}})}))],1),a("el-form-item",{attrs:{label:"文章标签"}},[a("el-select",{attrs:{placeholder:"请选择",multiple:"multiple",filterable:"filterable","allow-create":"allow-create"},model:{value:t.form.tagIds,callback:function(e){t.form.tagIds=e},expression:"form.tagIds"}},t._l(t.tags,function(t){return a("el-option",{attrs:{label:t.name,value:t.id}})}))],1)],1)],1),a("div",{staticClass:"markdown-editor"},[a("markdown-editor",{ref:"editor",attrs:{upload:t.uploadConfig,options:t.MarkdownOptions,height:"100%","z-index":"2017"},on:{"upload-error":t.uploadError,"save-history":t.saveHistory},model:{value:t.form.content,callback:function(e){t.form.content=e},expression:"form.content"}})],1),a("el-form-item",{attrs:{label:"摘要",prop:"summary",hidden:"hidden"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:8}},model:{value:t.form.summary,callback:function(e){t.form.summary=e},expression:"form.summary"}})],1),a("el-form-item",{staticClass:"el-dialog__footer"},[t.isDraft?a("el-button",{attrs:{type:"primary"},on:{click:function(e){e.preventDefault(),t.saveDraft(e)}}},[t._v("保存")]):t._e(),a("el-button",{attrs:{"native-type":"submit",type:"primary"},on:{click:function(e){e.preventDefault(),t.saveAction(e)}}},[t._v("保存并发布")])],1)],1)],1)},staticRenderFns:[]}}});